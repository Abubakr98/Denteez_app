$(document).ready(function() {
  fetch('http://504080.com/api/v1/directories/enquiry-types', {
    method: 'GET',
    headers: {
      'Authorization': 'f30fa27afb096d10078a384ebbb4da9e4be6a466'
    },
    mode: 'cors',
    cache: 'default'
  }).then(res => {
    console.log(res.status);
    return res.json()
  }).then(data => {
    var selects = data.data.map((el, i) => {
      return (`<option value="${el.name}">${el.name}</option>`);
    });
    $('.Form__select').html(selects);
  });
  var maxFileSize = 5000000;
  var fImg;
  var wImg = 0,
    hImg = 0;
  var photo_input = document.getElementById('photo_input');
  photo_input.onchange = function() {
    var reader = new FileReader();
    reader.onload = function(e) {
      var img = document.createElement('img');
      fImg=img;
      img.onload = function() {
        wImg = img.width;
        hImg = img.height;
      };
      img.src = e.target.result;
    }
    reader.readAsDataURL(this.files[0])
  }
  var forma=$('#myForm');
  forma.on('submit', function(){
      var forma=$('#myForm');
  var flagImg=false;
  // console.log($(this).find('input[name="filePhoto"]')[0].files.length);
  // console.log({"file-name":forma[0][6].files[0].name,data:fImg});
    if ($(this).find('input[name="filePhoto"]')[0].files.length==0) {
        flagImg=true
    }else{
      var photoSize = $(this).find('input[name="filePhoto"]')[0].files[0].size;
      console.log(photoSize);
      if (photoSize > maxFileSize) {
        event.preventDefault();
        alert(`The weight of the photo should not exceed 5mb!!!`);
      } else if (wImg > 300 || hImg > 300) {
        event.preventDefault();
        alert(`The size of the picture should not be more than 300x300!!!`);
      }else{
        console.log($("#select option:selected").text());
        // event.preventDefault();
        $.ajax({
          type: "POST", url: 'http://504080.com/api/v1/support', /////////////Here
          data: {
              'department':'1',
              'description':forma[0][5].value,
              'email':forma[0][3].value,
              'enquiry_type': forma[0][1].value ? forma[0][1].value : forma[0][0].value,
              'file':
                {}
              ,
              'subject':forma[0][4].value,
              'user_name':forma[0][2].value
          },
          success: (res)=>{alert(res.data.message)},
          dataType: 'JSON'
        });
        forma[0].reset();
      }
    }
  if (flagImg==true) {
    console.log($("#select option:selected").text());
    $.ajax({
      type: "POST", url: 'http://504080.com/api/v1/support', /////////////Here
      data: {
        'department':'1',
        'description':forma[0][5].value,
        'email':forma[0][3].value,
        'enquiry_type': forma[0][1].value ? forma[0][1].value : forma[0][0].value,
        'file':fImg ? {fImg} : {},
        'subject':forma[0][4].value,
        'user_name':forma[0][2].value
      },
      success: (res)=>{alert(res.data.message)},
      dataType: 'JSON'
    });
  }
  forma[0].reset();
  event.preventDefault();
});
});

function forreq() {
  var sel = $('#select');
  if (sel[0].value === "Other") {
    console.log("other");
    $("#forRequerd").attr("required", "required");
  } else {
    $("#forRequerd").removeAttr("required")
  }
}
